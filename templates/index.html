<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Secure file sharing with AES-256 encryption. Upload and download files safely." />
    <title>ğŸ” Secure File Sharing</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <meta name="csrf-token" content="{{ csrf_token() }}">
  </head>
  <body class="bg-light">
    <!-- Theme Toggle Button -->
    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark/light mode" title="Toggle theme">
      <span class="theme-icon">ğŸŒ™</span>
    </button>

    <!-- Drag & Drop Overlay -->
    <div id="drop-overlay" class="drop-overlay">
      <div class="drop-content">
        <span class="drop-icon">ğŸ“</span>
        <p>Drop file here to upload</p>
      </div>
    </div>

    <div class="container mt-5">
      <div class="text-center mb-4">
        <h1 class="fw-bold text-primary">ğŸ” Secure File Sharing Portal</h1>
        <p>Upload and download files safely with AES-256 encryption.</p>
        <small class="text-muted">Files expire after 7 days â€¢ Max 16MB â€¢ Rate limited</small>
      </div>

      <!-- Upload Section with Drag & Drop -->
      <div class="card shadow-sm mb-4" id="upload-card">
        <div class="card-header">
          <h5 class="mb-0">ğŸ“¤ Upload & Encrypt</h5>
        </div>
        <div class="card-body">
          <!-- Drag & Drop Zone -->
          <div id="drop-zone" class="drop-zone mb-3">
            <div class="drop-zone-content">
              <span class="drop-zone-icon">ğŸ“</span>
              <p class="drop-zone-text">Drag & drop a file here, or click to browse</p>
              <small class="text-muted">Max 16MB</small>
            </div>
            <input type="file" id="file" name="file" class="drop-zone-input" />
          </div>
          
          <form id="upload-form" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            
            <!-- Selected file display -->
            <div id="selected-file" class="selected-file mb-3" style="display: none;">
              <span class="selected-file-icon">ğŸ“„</span>
              <span id="selected-file-name">No file selected</span>
              <button type="button" id="clear-file" class="btn btn-sm btn-outline-danger ms-2">âœ•</button>
            </div>
            
            <div class="mb-3">
              <label for="password" class="form-label">Create encryption password:</label>
              <div class="input-group">
                <input type="password" class="form-control" id="password" name="password" required 
                       minlength="8" aria-describedby="passwordHelp" />
                <button class="btn btn-outline-secondary toggle-password" type="button" data-target="password" aria-label="Toggle password visibility">
                  ğŸ‘ï¸
                </button>
              </div>
              <div id="password-strength" class="password-strength mt-2"></div>
              <div id="passwordHelp" class="form-text">Min 8 chars, include uppercase, lowercase, and a number</div>
            </div>
            
            <!-- Upload Progress Bar -->
            <div class="progress mb-3" id="upload-progress-container" style="display: none;">
              <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" 
                   id="upload-progress" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
            </div>
            
            <button type="submit" class="btn btn-primary w-100" id="upload-btn">
              <span class="btn-text">Upload & Encrypt</span>
              <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            </button>
          </form>
        </div>
      </div>

      <!-- File List Section -->
      <div class="card shadow-sm mb-4" id="files-card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">ğŸ“ Encrypted Files</h5>
          <button class="btn btn-sm btn-outline-primary" id="refresh-files" aria-label="Refresh file list">
            ğŸ”„ Refresh
          </button>
        </div>
        <div class="card-body">
          <div id="files-loading" class="text-center py-3">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
          <div id="files-empty" class="text-center py-3 text-muted" style="display: none;">
            No encrypted files found. Upload your first file!
          </div>
          <div id="files-list" class="table-responsive" style="display: none;">
            <table class="table table-hover mb-0">
              <thead>
                <tr>
                  <th>Filename</th>
                  <th>Size</th>
                  <th>Downloads</th>
                  <th>Expires</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="files-tbody">
                <!-- Files will be populated here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Download Section -->
      <div class="card shadow-sm" id="download-card">
        <div class="card-header">
          <h5 class="mb-0">ğŸ“¥ Download & Decrypt</h5>
        </div>
        <div class="card-body">
          <form id="download-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="mb-3">
              <label for="filename" class="form-label">Enter filename to download:</label>
              <input type="text" class="form-control" id="filename" name="filename" required placeholder="e.g. document_abc123.pdf" />
            </div>
            <div class="mb-3">
              <label for="password_dl" class="form-label">Enter decryption password:</label>
              <div class="input-group">
                <input type="password" class="form-control" id="password_dl" name="password" required />
                <button class="btn btn-outline-secondary toggle-password" type="button" data-target="password_dl" aria-label="Toggle password visibility">
                  ğŸ‘ï¸
                </button>
              </div>
            </div>
            <button type="submit" class="btn btn-success w-100" id="download-btn">
              <span class="btn-text">Download & Decrypt</span>
              <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            </button>
          </form>
        </div>
      </div>
      
      <!-- Footer -->
      <footer class="text-center mt-4 mb-4 text-muted">
        <small>ğŸ”’ Files are encrypted with AES-256. Your password is never stored.</small>
      </footer>
    </div>
    
    <div id="toast-container"></div>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
  </body>
</html>
